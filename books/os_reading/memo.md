## sec 1
UNIX V6

### 汎用レジスタ

| レジスタ | 用途 |
| --- | --- |
| r0,r1 | 計算用、関数の戻り値 |
| r2,r3,r4 | ローカル処理 |
| r5 | フレームポインタ、環境ポインタ |
| r6 (sp) | スタックポインタ |
| r7 (pc) | プログラムカウンタ |

- r6は、各プロセスが持つスタックの先頭
  - r6 のみカーネルモード用とユーザーモード用に分かれている。
- プロセッサはr7で示されたメモリアドレスから命令を読み込み、解釈して処理する

### MMU
Memory Management Unit

アドレス変換やアクセス権限の管理などを行う

### マニュアル
「UNIX Programmer's Manual」（UPM）

カーネルを読むには特に2,4章が重要

## sec 2
カーネルはプロセスという概念を用いて、実行中のプログラムを管理する

カーネルによる、TSS（タイムシェアリングシステム）によって、あたかも平行処理しているように見える

### proc 構造体と user 構造体
各プロセスの状態情報や制御情報などは、proc 構造体と user 構造体のくみにより管理される。プロセスごとにそれぞれ1つずつ割り当てられる。proc構造体はメモリに常駐し、user構造体はスワップアウトの対象となるという点が異なる

### proc構造体
常にカーネルから必要とされる情報を扱う

### メモ
- システムコールの処理はカーネルプロセスにより行われる


## sec 3

### メモ
- fork システムコールはプロセスを生成する。子プロセスは親プロセスのコピーである
- waitシステムコールは子プロセスの処理完了を待つためにスリープし、子プロセスが終了すると子プロセスの後始末を行う。
- exec システムコールは実行プログラムファイルをメモリに読み込み、プログラムの実行環境を構築する
- exit システムコールはプロセスをゾンビ状態にする。ゾンビ状態になったプロセスは親プロセスに始末される
- init プロセスは親プロセスを失って宙に浮いたプロセスを始末する責務を持つ
- 実行プロセスを中断すると、実行優先度の高い実行可能状態のプロセスに切り替わる
- r5, r6, ユーザAPR, カーネルPAR6 の復帰、退避を行うことでコンテキストスイッチを実現している
- sleep()とwakeup()を使って資源を待ち合う処理をしている。
- 物理メモリとスワップ領域は、map 構造体を使用して同じロジックで空き領域を管理している。
- 空き領域獲得処理のアルゴリズムには First Fit を採用している


## sec 5
割り込み

システムコールはトラップの仕組みを用いて実現されている。

### システムコール
ユーザプログラムはシステムコールと呼ばれる仕組みを使って、カーネルが提供している機能の実行要求を行う。


