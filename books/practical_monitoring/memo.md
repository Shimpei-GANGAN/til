## sec 1: 監視のアンチパターン
アンチパターンとは、一見良いアイデアだが実装すると手痛いしっぺ返しをしっぺ返しをくらうものを言う

## sec 2: 監視のデザインパターン

### 組み合わせ可能な監視（composable monitoring）

専門化されたツールを複数使い、それらを疎に結合さkせて、監視「プラットフォーム」を作ること

１つのツールにこだわる必要がない！あるツールが合わなくなった時は、そのツールだけを削除・変更すれば良い。アーキテクチャが複雑になるが、より柔軟になりその恩恵の方が大きい

### 監視サービスのコンポーネント
- データ収集
- データストレージ
- 可視化
- 分析とレポート
- アラート

### データ収集
プッシュとプルの２つの方法が存在する

#### プル型
  - サービスがリモートノードに対して、ノードの情報を送りつけてくるように要求
  - SNMP, Nagios
  - 中央システムが全てのクライアントを把握してスケジュールし、応答をパースしなくてはならないので、スケールがしにくい

#### プッシュ型
  - クライアント（サーバやアプリケーション）はデータを他の場所に、一定間隔あるいはイベントが発生したタイミングでプッシュする
  - syslog の転送は、不定期なイベントを含むプッシュ型の良い例
  - collectd
  - ポーリングを行う中央サーバは存在しないので、クラウド環境のように分散アーキテクチャではスケールしやすくなる

### メトリクス
メトリクスには２つの表現方法がある

#### カウンタ
カウンタは増加していくメトリクス。車の走行距離計のようなもの。Web サイトに訪れる累計人数といった用途に最適。

カウンタには上限があり、上限を超えると０に戻ることに注意（ネトワーク機器くらい）

#### ゲージ
ある時点の値。車の速度計のようなもの。

弱点としては、過去の値について何の情報も与えてくれないこと。しかし、ゲージの値を時系列データベース（TSDB）に保存することで、後から過去のデータを取り出したり、グラフにプロットできたりする。

### ログ
ログには、メトリクスが持つよりかなり多い情報を持てるので、人間が読むことなしに情報を抽出するには、何らかのパースが必要になることが多い。

構造化ログと非構造化ログの２つのタイプがある。多くの人が馴染みがあるのは非構造化の方。

NGINX のログなど、どれが何を表してるのかが順番でのみ決まってるようなものは非構造化

JSON のように、キーの値とペアの集合で書かれたものは構造化といえる！

### アラート
> 監視は、質問を投げかけるためにある！

アラートは結果の１つの形でしかない

### どこから監視を始めるか？
ユーザーから！

ユーザーが気にするのは、アプリケーションが動いているかどうか

このメトリクスはユーザへの影響をどう教えてくれるか、と常に自問自答する

