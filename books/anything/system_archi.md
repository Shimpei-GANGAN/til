# システム設計の原則
現場で役立つシステム設計の原則

Principles of the Systems Architecture

## 場合分けのロジックを整理する
- 判断ロジックと分岐後のロジックを、それぞれメソッドに抽出する
- else 句をなくすことも考える
- 早期リターンする書き方を**ガード節**という
- 多態（区分ごとに異なるクラスのオブジェクトを「同じ型」として扱う仕組み）
  - クラスとクラスの関係は、お互いの「知ってること」を少なくする！
  - 区分ごとのロジックをクラス単位に分離してコードを読みやすくするオブジェクト指向らしいしくみ

## 三層アーキテクチャ
- MVC
  - Model, View, Controller
- プレゼンテーション層、アプリケーション層、データベース層
  - プレゼンテーション層：画面や外部接続インタフェース
  - アプリケーション層：業務ロジック、業務ルール
  - データベース層：データベース入出力

この２つどー使い分ける？

データを持つクラスに業務ロジックを集める。getter の身のメソッドを作らない。

- メソッドは必ずインスタンス変数を使う
  - インスタンス変数を使わないメソッドは、そのクラスのメソッドとして不適切
  - 置き場所を再検討すべき
  - 凝集度を高くする

## p76
クラス設計で大切なことは、使う側のクラスのコードがシンプルになるように設計すること。次の点に気を配る

- メソッドをロジックの置き場所にする
- ロジックを、データを持つクラスに移動する
- 使う側のクラスにロジックを書き始めたら設計を見直す
- メソッドを短くして、ロジックの移動をやりやすくする
- クラスが肥大化したら小さく分ける

## ドメインオブジェクト
- 関連する業務データと業務ロジックを１つにまとめたもの
- 三層＋ドメインモデルを目指していこ
- 煩雑になってきたら、パッケージを分けることでグルーピングする

### 三層＋ドメインモデル
- 業務ロジックを記述するのはドメインモデルだけ。
- 業務的な判断・加工・計算のロジックは、全て、ドメインオブジェクトに任せる。
- 業務ロジックの複雑さをドメインモデルとして分離整理する

#### 役割
| 名前 |　役割 |
| --- | --- |
| プレゼンテーション層 | UI など外部との入出力を受け持つ |
| アプリケーション層 | 業務機能のマクロな手順の記述 |
| データソース層 | データベースとの入出力を受け持つ |
| ドメインモデル | 業務データと関連する業務ロジックを<br />表現したドメインオブジェクトの集合 |


## sec 4 ドメインモデルの考え方を理解する

### ドメインモデルの何が良いのか
業務ロジックが複雑な場合は、データクラスと機能クラスを分ける手続き型の設計よりも、オブジェクト指向で業務ロジックを整理するドメインモデルのほうが良いと言われている。ドメインモデルで設計する狙いは次の３つ

- 業務的な判断/加工/計算のロジックを重複なく一元的に記述する
- 業務の関心事とコードを直接対応させ、どこに何が書いてあるかわかりやすく整理する
- 業務ルールの変更や追加の時に、変更の影響を狭い範囲に閉じ込める

ドメインモデルは、プログラミング言語でかいた「業務の用語集」であり「業務の説明書」である。

### 利用者の関心ごととプログラミング単位を一致させる
- 分析：人間のやりたいことを正しく理解する
- 設計：人間のやりたいことを動くソフトウェアとして実現する方法を考える

<span style="color: red">設計では次のような内容を検討し、決定する</span>

- パッケージ構成と名前
- クラス構成と名前
- メソッド構成と名前

ドメインモデルの設計とは、業務を理解するための分析と、ソフトウェアとして実現するための設計が、一体になった活動




## memo
- 説明用の変数の導入
  - 破壊的代入は、変更の副作用を起こしやすい
- メソッドの抽出
- 狭い関心ごとに特化したクラスにする
  - その用語の関心ごとに対応するクラスを**ドメインオブジェクト**と呼ぶ
- 業務アプリケーションをオブジェクト指向で設計する場合には、業務で扱うデータの種類ごとに専用の「型」（クラスやインターフェース）を用意する。
  - 値オブジェクト（Value Object）
    - 値オブジェクトの値は「不変」にする
    - 別の値が必要になったら、「別のオブジェクト」を作成する！
- 値オブジェクト生成
  - 業務の関心ごとを直接的に表現する
  - インスタンス変数はコンストラクタでオブジェクトの生成時に設定する
  - インスタンス変数を変更するメソッドを作らない
  - 別の値が必要であれば、別のインスタンスを作る
- 完全コンストラクタ：
  - オブジェクトの作成時に、オブジェクトの状態を完全に設定するやり方
  - String / BigDecimal / LocalDate など
- コレクションオブジェクト
  - リストやコレクションの操作などは、コードを複雑に見せてしまう
  - その関係を、全て１つのクラスに閉じ込める


