# リーダブルコード

- time_str += (hour >= 12)? "pm" : "am"
- 条件は**前もって**書きたい
  - do-while は避けたい
- 関数から早く返す
  - with, try-finally などのクリーンアップコードのイディオム
  - 早期リターンを利用して、ネストを浅くする
    - ネストとは、「精神的スタックに条件をプッシュする」こと
- 説明変数
  - 式を簡単に分割する方法
- 変数のスコープを縮める
  - 変数のことが見えるコードの行数をできるだけ減らす

## 無関係の下位問題を抽出する
1. 関数やコードブロックを見て「このコードの高レベルの目標は何か？」と自問する
2. コードの各行に対して「高レベルの目標に直接的に効果があるのか？あるいは、無関係の下位問題を解決しているのか？」と自問する
3. 無関係の下位問題を解決しているコードが相当量あれば、それらを抽出して別の関数にする

下位問題は、自分がアプリケーションに**どのように使われるかを知らない**

### 汎用コードをたくさん作る
- 関数というのは、小さくて独立したものになっていれば、機能追加・読みやすさの向上・エッジケースの処理などが楽にできる
- プロジェクトから完全に切り離されたもの
- プロジェクト固有のコードから汎用コードを分離する！


## 短いコードを書く
- もっとも読みやすいコードは、何も書かれていないコードだ
- その機能の実装について悩まないで
  - きっと必要ないから
- キャッシュを追加する
  - LRU 方式のキャッシュ (Least Recently Used)
  - 単項目キャッシュ (one-item cache)
- コードをできるだけ小さく軽量に維持する
  - 汎用な「ユーティリティ」コードを作って、重複コードを削除する
  - 未使用のコードや無用の機能を削除する
  - プロジェクトをサブプロジェクトに分割する
  - コードの「重量」を意識する。軽量で機敏にしておく

### 身近なライブラリに親しむ
- たまには標準ライブラリの全ての関数・モジュール・型の名前を15分かけて読んでみる
- 平均的なソフトウェアエンジニアが1日に書く出荷用のコードは、10行


## テストと読みやすさ
- テストコードは、「本物のコードの動作と使い方を示した非公式的な文章」
- テストの本質は、「こういう状況と入力から、こういう振る舞いと出力を期待する」のレベルまで要約できる。

### 基本的な考え方
- テストステートメントはあまり長くしてはいけない
  - 必要なら、ヘルパー関数を使う
  - テストを簡単に追加できるように工夫する
- 失敗メッセージが役に立たない
  - デバッグに必要な情報を表示させる
  - 高度な assertion を使う
- テストは恐れず分割する（通常ケースとマイナス値を含むケースなど）
- テストの入力値は単純な値にする（×: -9998.7, ○: -1）
- テストの入力値が不完全である
- 極端な入力値を使ってテストをしていない
  - 空のベクタ・巨大なベクタ・スコアが重複したもの、など
- テスト関数には意味のある名前をつける
  - テストする関数や状況を表したものにするべき

### テストに優しい開発
- テストしやすいようにコードを設計する
- すると、いいコードが書けるようになる！
  - 振る舞いごとにうまく分割されて、自然にコードが構成されていく
  - 疎結合にする！

#### テスト容易性の低いコードの特性とそこから生じる設計の問題
- グローバル変数を使っている
  - グローバルの状態をテストごとに初期化する必要がある
  - どの関数にどんな副作用があるのかわかりにくい。関数を個別に考えることができない。
- 多くの外部コンポーネントに依存している
  - 最初に足場を設定しなければいけないので、テストを書くのが難しい
  - 依存しているものが落ちるとシステムが使えなくなる。任意の変更にどんな影響があるのかを理解するのが難しい。
- コードが非決定的な動作をする
  - テストは当てにならず、信頼できない
  - プログラムが強豪状態になったり、再現不可能なバグが発生したりする。

#### テスト容易性の高いコードの特性とそこから生じる設計の利点
- クラスが小さい。あるいは、内部状態を持たない。
  - テストがしやすい。セットアップがあまり必要にならない
  - 状態の少ないクラスは単純で理解しやすい
- クラスや関数が１つのことをしている
  - 完全にテストをするためのテストケースが少なくて済む
  - 小さくて単純なコンポーネントがモジュール化されている。システムは疎結合
- クラスは他のクラスにあまり依存していない
  - 各クラスは独立してテストできる
  - システムあh並列的に開発できる。
- 関数は単純でインタフェースが明確
  - テストが楽
  - インタフェースがわかりやすく、再利用しやすい


